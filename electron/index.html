<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DB Simulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .btn {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .section h2 {
            margin-top: 0;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>DB Simulator</h1>
        
        <div class="section">
            <h2>Configurations</h2>
            <button id="get-configs" class="btn">Get Configurations</button>
            <div id="config-output"></div>
        </div>
        
        <div class="section">
            <h2>Database Generation</h2>
            <p>Generate a synthetic database using a configuration.</p>
            <label for="config-select">Select Configuration:</label>
            <select id="config-select">
                <option value="">--Select a config--</option>
            </select>
            <button id="generate-db" class="btn">Generate Database</button>
            <div id="generate-output"></div>
        </div>
        
        <div class="section">
            <h2>Simulation</h2>
            <p>Run a simulation on a database.</p>
            <label for="sim-config-select">Select Configuration:</label>
            <select id="sim-config-select">
                <option value="">--Select a config--</option>
            </select>
            <label for="database-path">Database Path:</label>
            <input type="text" id="database-path" placeholder="Path to SQLite database">
            <button id="run-simulation" class="btn">Run Simulation</button>
            <div id="simulation-output"></div>
        </div>
    </div>

    <script>
        // Wait for the document to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Get DOM elements
            const getConfigsBtn = document.getElementById('get-configs');
            const configOutput = document.getElementById('config-output');
            const configSelect = document.getElementById('config-select');
            const simConfigSelect = document.getElementById('sim-config-select');
            const generateDbBtn = document.getElementById('generate-db');
            const generateOutput = document.getElementById('generate-output');
            const databasePath = document.getElementById('database-path');
            const runSimulationBtn = document.getElementById('run-simulation');
            const simulationOutput = document.getElementById('simulation-output');
            
            // Get configurations
            getConfigsBtn.addEventListener('click', async function() {
                try {
                    configOutput.textContent = 'Loading configurations...';
                    const configs = await window.api.getConfigurations();
                    
                    // Display configurations
                    configOutput.innerHTML = `<pre>${JSON.stringify(configs, null, 2)}</pre>`;
                    
                    // Populate select dropdowns
                    populateConfigSelect(configs);
                } catch (error) {
                    configOutput.textContent = `Error: ${error.message}`;
                }
            });
            
            // Generate database
            generateDbBtn.addEventListener('click', async function() {
                const configId = configSelect.value;
                if (!configId) {
                    generateOutput.textContent = 'Please select a configuration first.';
                    return;
                }
                
                try {
                    generateOutput.textContent = 'Generating database...';
                    const result = await window.api.generateDatabase({
                        config_id: configId,
                        output_dir: 'output',
                        name: 'generated_db'
                    });
                    
                    generateOutput.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
                    
                    // Auto-fill database path
                    if (result.database_path) {
                        databasePath.value = result.database_path;
                    }
                } catch (error) {
                    generateOutput.textContent = `Error: ${error.message}`;
                }
            });
            
            // Run simulation
            runSimulationBtn.addEventListener('click', async function() {
                const configId = simConfigSelect.value;
                const dbPath = databasePath.value;
                
                if (!configId || !dbPath) {
                    simulationOutput.textContent = 'Please select a configuration and provide a database path.';
                    return;
                }
                
                try {
                    simulationOutput.textContent = 'Running simulation...';
                    const result = await window.api.runSimulation({
                        config_id: configId,
                        database_path: dbPath
                    });
                    
                    simulationOutput.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
                } catch (error) {
                    simulationOutput.textContent = `Error: ${error.message}`;
                }
            });
            
            // Helper function to populate configuration select dropdowns
            function populateConfigSelect(configs) {
                // Clear existing options
                configSelect.innerHTML = '<option value="">--Select a config--</option>';
                simConfigSelect.innerHTML = '<option value="">--Select a config--</option>';
                
                if (configs && configs.configs) {
                    configs.configs.forEach(config => {
                        const option = document.createElement('option');
                        option.value = config.id;
                        option.textContent = `${config.name} (${config.config_type})`;
                        
                        if (config.config_type === 'database') {
                            configSelect.appendChild(option.cloneNode(true));
                        } else if (config.config_type === 'simulation') {
                            simConfigSelect.appendChild(option.cloneNode(true));
                        }
                    });
                }
            }
        });
    </script>
</body>
</html> 