entities:
  # Inventory table - represents available books (non-consumable resources with quantity tracking)
  - name: Book
    type: inventory  # New type for inventory tracking
    rows: 50  # Initial number of different book titles
    attributes:
      - name: id
        type: pk
      - name: isbn
        type: string
        generator:
          type: faker
          method: isbn13
      - name: title
        type: string
        generator:
          type: faker
          method: catch_phrase
      - name: author
        type: string
        generator:
          type: faker
          method: name
      - name: price
        type: float
        generator:
          type: distribution
          formula: UNIF(9.99, 49.99)
      - name: quantity  # Critical inventory field - tracks available stock
        type: integer
        generator:
          type: distribution
          formula: UNIF(5, 100)  # Initial stock levels per book
      - name: category
        type: string
        generator:
          type: distribution
          formula: DISC(0.3, Fiction, 0.25, Non-Fiction, 0.2, Science, 0.15, Biography, 0.1, Other)

  # Customer table
  - name: Customer
    rows: 100
    attributes:
      - name: id
        type: pk
      - name: name
        type: string
        generator:
          type: faker
          method: name
      - name: email
        type: string
        generator:
          type: faker
          method: email
      - name: signup_date
        type: datetime
        generator:
          type: formula
          expression: "MIN(SELECT created_at FROM Order WHERE customer_id = @id) - DAYS(RANDOM(30, 365))"

  # Order entity table - created during simulation with inventory requirements
  - name: Order
    type: entity
    rows: n/a  # Created dynamically during simulation
    attributes:
      - name: id
        type: pk
      - name: customer_id
        type: fk
        ref: Customer.id
        generator:
          type: foreign_key
          formula: UNIF(1, 100)
      - name: created_at
        type: datetime
      - name: status
        type: string
        default: pending
      - name: total_amount
        type: float
        default: 0.0
      # Inventory metadata - populated during entity creation based on inventory_requirements
      - name: selected_inventory  # JSON array of selected inventory item IDs
        type: json
      - name: inventory_quantities  # JSON array of quantities for each inventory item
        type: json

  # Event tracking table for simulation
  - name: Order_Event
    type: event
    rows: n/a
    attributes:
      - name: id
        type: pk
      - name: order_id
        type: entity_id
        ref: Order.id
        generator:
          type: foreign_key
          subtype: one_to_many
      - name: event_type
        type: event_type
      - name: timestamp
        type: datetime
      - name: details
        type: string